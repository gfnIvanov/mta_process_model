schema: '2.0'
stages:
  genetics_to_yaml_file:
    cmd:
    - make del-dep-file path=data/interim/genetics/deleted_data.yaml
    - make del-dep-file path=data/processed/genetics/data.yaml
    - make del-dep-file path=data/processed/genetics/data.csv
    - poetry run parse_xml --datatype=genetics 100
    deps:
    - path: data/raw/genetics
      hash: md5
      md5: 0250714d3186380756572efffbfd1c95.dir
      size: 546626736
      nfiles: 21404
    - path: src/data/process.py
      hash: md5
      md5: 4b5061fc8328d5dad821378426de33d8
      size: 4235
    - path: src/data/utils/_parse_xml.py
      hash: md5
      md5: 8e023d8005356aff5612cd6446df69cd
      size: 2635
    - path: src/data/utils/general.py
      hash: md5
      md5: b713fdfff3d219cd4d256236a48a0525
      size: 3351
    params:
      params/data.yaml:
        paths.genetics:
          raw: data/raw/genetics
          int: data/interim/genetics
          res: data/processed/genetics
    outs:
    - path: data/interim/genetics/data.yaml
      hash: md5
      md5: 195080bd62334e33757758bae47d5418
      size: 479935
  depers_genetics:
    cmd:
    - make del-dep-file path=data/interim/genetics/deleted_data.yaml
    - make del-dep-file path=data/processed/genetics/data.yaml
    - make del-dep-file path=data/processed/genetics/data.csv
    - poetry run depers --datatype=genetics --model=labse
    deps:
    - path: data/interim/genetics/data.yaml
      hash: md5
      md5: 195080bd62334e33757758bae47d5418
      size: 479935
    - path: src/data/process.py
      hash: md5
      md5: 4b5061fc8328d5dad821378426de33d8
      size: 4235
    - path: src/data/utils/_depersonalization.py
      hash: md5
      md5: fb97c72d19ba5252dd2d87d6eb99739b
      size: 4242
    - path: src/data/utils/general.py
      hash: md5
      md5: b713fdfff3d219cd4d256236a48a0525
      size: 3351
    params:
      params/data.yaml:
        paths.genetics:
          raw: data/raw/genetics
          int: data/interim/genetics
          res: data/processed/genetics
      params/models.yaml:
        depers:
          sber:
            name: viktoroo/sberbank-rubert-base-collection3
            tags:
            - B-PER
            - I-PER
          labse:
            name: surdan/LaBSE_ner_nerel
            tags:
            - B-PERSON
            - I-PERSON
    outs:
    - path: data/interim/genetics/deleted_data.yaml
      hash: md5
      md5: 3f0155807ef991c820526676a3c0ea41
      size: 13066
    - path: data/processed/genetics/data.yaml
      hash: md5
      md5: 0a658fa0057a2c55ec4c8275f4452f7d
      size: 418198
  train_models:
    cmd:
    - poetry run train --datatype=genetics --model=bert
    params:
      params/data.yaml:
        paths.genetics:
          raw: data/raw/genetics
          int: data/interim/genetics
          res: data/processed/genetics
      params/models.yaml:
        for_train:
          bert: alexyalunin/RuBioRoBERTa
          gpt:
            large: sberbank-ai/rugpt3large_based_on_gpt2
            medium: sberbank-ai/rugpt3medium_based_on_gpt2
            small: sberbank-ai/rugpt3small_based_on_gpt2
  prepare_dataset:
    cmd:
    - make del-dep-file path=data/processed/genetics/data.csv
    - poetry run prepare_dataset --datatype=genetics --to_s3=true
    deps:
    - path: data/processed/genetics/data.yaml
      hash: md5
      md5: 0a658fa0057a2c55ec4c8275f4452f7d
      size: 418198
    - path: src/data/process.py
      hash: md5
      md5: b3588ea6228dca59e0da0c27351b135d
      size: 4514
    - path: src/data/utils/_prepare_dataset.py
      hash: md5
      md5: ea55e516a956c48c0c5b5f91c9f8181b
      size: 856
    - path: src/data/utils/general.py
      hash: md5
      md5: b713fdfff3d219cd4d256236a48a0525
      size: 3351
    params:
      params/data.yaml:
        paths.genetics:
          raw: data/raw/genetics
          int: data/interim/genetics
          res: data/processed/genetics
        s3_storage:
          url: https://storage.yandexcloud.net
          bucket: mta-processed-objects
      params/models.yaml:
        depers:
          sber:
            name: viktoroo/sberbank-rubert-base-collection3
            tags:
            - B-PER
            - I-PER
          labse:
            name: surdan/LaBSE_ner_nerel
            tags:
            - B-PERSON
            - I-PERSON
        for_train:
          bert: alexyalunin/RuBioRoBERTa
          gpt:
            large: sberbank-ai/rugpt3large_based_on_gpt2
            medium: sberbank-ai/rugpt3medium_based_on_gpt2
            small: sberbank-ai/rugpt3small_based_on_gpt2
    outs:
    - path: data/processed/genetics/data.csv
      hash: md5
      md5: 3c6c92a56fb4e9c718159daa4b234530
      size: 393524
